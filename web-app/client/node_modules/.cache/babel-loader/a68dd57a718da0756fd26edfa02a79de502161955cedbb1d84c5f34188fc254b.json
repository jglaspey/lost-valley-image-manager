{"ast":null,"code":"import React,{useMemo}from'react';import{MasonryInfiniteGrid}from'@egjs/react-infinitegrid';import{Download}from'lucide-react';import{Button}from'./ui/button';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export function MasonryGallery(_ref){let{images,onImageClick}=_ref;// Golden ratio sizing calculation\nconst getImageSize=image=>{const baseWidth=200;const œÜ=1.618;// Golden ratio\n// Get the highest score from all three metrics\nconst maxScore=Math.max(image.visual_quality,image.social_media_score,image.marketing_score);// 10% chance for random size bump for visual interest\nconst randomBump=Math.random()<0.1;let width=baseWidth;if(maxScore>=5||randomBump){width=baseWidth*œÜ*œÜ;// ~524px for score 5s\n}else if(maxScore>=4){width=baseWidth*œÜ;// ~324px for score 4s  \n}else if(maxScore>=3){width=baseWidth;// 200px for score 3s\n}else{width=baseWidth/œÜ;// ~124px for scores 1-2\n}return Math.round(width);};// Process images with size data\nconst processedImages=useMemo(()=>{return images.map((image,index)=>{const width=getImageSize(image);const maxScore=Math.max(image.visual_quality,image.social_media_score,image.marketing_score);return{...image,width,groupKey:maxScore>=4?'hero':'standard',// For organic clustering\nkey:`image-${image.id}-${index}`// Unique key for React\n};});},[images]);const handleDownload=(e,image)=>{e.stopPropagation();const downloadUrl=`/api/download/${image.drive_file_id}`;const link=document.createElement('a');link.href=downloadUrl;link.download=image.filename;document.body.appendChild(link);link.click();document.body.removeChild(link);};const getScoreColor=score=>{if(score>=4)return'text-green-600 font-medium';if(score>=3)return'text-yellow-600';return'text-red-600';};if(images.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center py-16 text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-6xl mb-4\",children:\"\\uD83D\\uDD0D\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg mb-2\",children:\"No images found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-muted-foreground max-w-md\",children:\"Try adjusting your search query or filters to find more images in your collection.\"})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"w-full\",children:/*#__PURE__*/_jsx(MasonryInfiniteGrid,{className:\"w-full\",gap:16// 16px spacing between items\n,useResizeObserver:true,observeChildren:true,transitionDuration:300,children:processedImages.map(item=>/*#__PURE__*/_jsx(\"div\",{\"data-grid-groupkey\":item.groupKey,\"data-grid-width\":item.width,className:\"group cursor-pointer transition-all duration-300 hover:shadow-xl\",style:{width:`${item.width}px`},onClick:()=>onImageClick(item),children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail_path||`/api/thumbnails/${item.drive_file_id}?size=800x600`,alt:item.primary_subject,className:\"w-full h-auto object-cover\",style:{aspectRatio:'auto'},onError:e=>{var _target$nextElementSi;const target=e.target;target.style.display='none';(_target$nextElementSi=target.nextElementSibling)===null||_target$nextElementSi===void 0?void 0:_target$nextElementSi.classList.remove('hidden');}}),/*#__PURE__*/_jsx(\"div\",{className:\"hidden w-full h-48 bg-gray-200 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-gray-500 text-sm\",children:/*#__PURE__*/_jsx(\"div\",{children:\"Image unavailable\"})})}),/*#__PURE__*/_jsx(Button,{variant:\"ghost\",size:\"sm\",onClick:e=>handleDownload(e,item),className:\"absolute top-2 right-2 h-8 w-8 p-0 bg-white/90 hover:bg-white opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-full\",title:\"Download original file\",children:/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 space-y-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium truncate\",title:item.filename,children:item.filename}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500 truncate\",title:item.file_path,children:item.file_path}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-center text-xs\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:`${getScoreColor(item.visual_quality)}`,children:[\"VQ: \",item.visual_quality,\"/5\"]}),/*#__PURE__*/_jsxs(\"span\",{className:`${getScoreColor(item.social_media_score)}`,children:[\"SM: \",item.social_media_score,\"/5\"]}),/*#__PURE__*/_jsxs(\"span\",{className:`${getScoreColor(item.marketing_score)}`,children:[\"MK: \",item.marketing_score,\"/5\"]})]})})]})]})},item.key))})});}","map":{"version":3,"names":["React","useMemo","MasonryInfiniteGrid","Download","Button","jsx","_jsx","jsxs","_jsxs","MasonryGallery","_ref","images","onImageClick","getImageSize","image","baseWidth","œÜ","maxScore","Math","max","visual_quality","social_media_score","marketing_score","randomBump","random","width","round","processedImages","map","index","groupKey","key","id","handleDownload","e","stopPropagation","downloadUrl","drive_file_id","link","document","createElement","href","download","filename","body","appendChild","click","removeChild","getScoreColor","score","length","className","children","gap","useResizeObserver","observeChildren","transitionDuration","item","style","onClick","src","thumbnail_path","alt","primary_subject","aspectRatio","onError","_target$nextElementSi","target","display","nextElementSibling","classList","remove","variant","size","title","file_path"],"sources":["/Users/jasonglaspey/Coding/Lost Valley - Image Management/web-app/client/src/components/MasonryGallery.tsx"],"sourcesContent":["import React, { useMemo } from 'react';\nimport { MasonryInfiniteGrid } from '@egjs/react-infinitegrid';\nimport { Download } from 'lucide-react';\nimport { Button } from './ui/button';\nimport { ProcessedImage } from '../types/image';\n\ninterface MasonryGalleryProps {\n  images: ProcessedImage[];\n  onImageClick: (image: ProcessedImage) => void;\n}\n\nexport function MasonryGallery({ images, onImageClick }: MasonryGalleryProps) {\n  // Golden ratio sizing calculation\n  const getImageSize = (image: ProcessedImage) => {\n    const baseWidth = 200;\n    const œÜ = 1.618; // Golden ratio\n    \n    // Get the highest score from all three metrics\n    const maxScore = Math.max(\n      image.visual_quality,\n      image.social_media_score, \n      image.marketing_score\n    );\n    \n    // 10% chance for random size bump for visual interest\n    const randomBump = Math.random() < 0.1;\n    \n    let width = baseWidth;\n    \n    if (maxScore >= 5 || randomBump) {\n      width = baseWidth * œÜ * œÜ; // ~524px for score 5s\n    } else if (maxScore >= 4) {\n      width = baseWidth * œÜ; // ~324px for score 4s  \n    } else if (maxScore >= 3) {\n      width = baseWidth; // 200px for score 3s\n    } else {\n      width = baseWidth / œÜ; // ~124px for scores 1-2\n    }\n    \n    return Math.round(width);\n  };\n\n  // Process images with size data\n  const processedImages = useMemo(() => {\n    return images.map((image, index) => {\n      const width = getImageSize(image);\n      const maxScore = Math.max(\n        image.visual_quality,\n        image.social_media_score, \n        image.marketing_score\n      );\n      \n      return {\n        ...image,\n        width,\n        groupKey: maxScore >= 4 ? 'hero' : 'standard', // For organic clustering\n        key: `image-${image.id}-${index}` // Unique key for React\n      };\n    });\n  }, [images]);\n\n  const handleDownload = (e: React.MouseEvent, image: ProcessedImage) => {\n    e.stopPropagation();\n    const downloadUrl = `/api/download/${image.drive_file_id}`;\n    \n    const link = document.createElement('a');\n    link.href = downloadUrl;\n    link.download = image.filename;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 4) return 'text-green-600 font-medium';\n    if (score >= 3) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  if (images.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-16 text-center\">\n        <div className=\"text-6xl mb-4\">üîç</div>\n        <h3 className=\"text-lg mb-2\">No images found</h3>\n        <p className=\"text-muted-foreground max-w-md\">\n          Try adjusting your search query or filters to find more images in your collection.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"w-full\">\n      <MasonryInfiniteGrid\n        className=\"w-full\"\n        gap={16} // 16px spacing between items\n        useResizeObserver={true}\n        observeChildren={true}\n        transitionDuration={300}\n      >\n        {processedImages.map((item) => (\n          <div\n            key={item.key}\n            data-grid-groupkey={item.groupKey}\n            data-grid-width={item.width}\n            className=\"group cursor-pointer transition-all duration-300 hover:shadow-xl\"\n            style={{ width: `${item.width}px` }}\n            onClick={() => onImageClick(item)}\n          >\n            <div className=\"relative bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300\">\n              {/* Image */}\n              <div className=\"relative\">\n                <img\n                  src={item.thumbnail_path || `/api/thumbnails/${item.drive_file_id}?size=800x600`}\n                  alt={item.primary_subject}\n                  className=\"w-full h-auto object-cover\"\n                  style={{ aspectRatio: 'auto' }}\n                  onError={(e) => {\n                    const target = e.target as HTMLImageElement;\n                    target.style.display = 'none';\n                    target.nextElementSibling?.classList.remove('hidden');\n                  }}\n                />\n                <div className=\"hidden w-full h-48 bg-gray-200 flex items-center justify-center\">\n                  <div className=\"text-center text-gray-500 text-sm\">\n                    <div>Image unavailable</div>\n                  </div>\n                </div>\n                \n                {/* Download Button */}\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={(e) => handleDownload(e, item)}\n                  className=\"absolute top-2 right-2 h-8 w-8 p-0 bg-white/90 hover:bg-white opacity-0 group-hover:opacity-100 transition-all duration-200 rounded-full\"\n                  title=\"Download original file\"\n                >\n                  <Download className=\"w-4 h-4\" />\n                </Button>\n              </div>\n              \n              {/* Metadata */}\n              <div className=\"p-3 space-y-2\">\n                <div className=\"text-sm font-medium truncate\" title={item.filename}>\n                  {item.filename}\n                </div>\n                <div className=\"text-xs text-gray-500 truncate\" title={item.file_path}>\n                  {item.file_path}\n                </div>\n                <div className=\"flex justify-between items-center text-xs\">\n                  <div className=\"flex gap-2\">\n                    <span className={`${getScoreColor(item.visual_quality)}`}>\n                      VQ: {item.visual_quality}/5\n                    </span>\n                    <span className={`${getScoreColor(item.social_media_score)}`}>\n                      SM: {item.social_media_score}/5\n                    </span>\n                    <span className={`${getScoreColor(item.marketing_score)}`}>\n                      MK: {item.marketing_score}/5\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        ))}\n      </MasonryInfiniteGrid>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}